<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type=text/css href="{{url_for('static', filename='style.css')}}" />

<style type="text/css">
div#fuente
{
    font-family: "Verdana";
    font-size: {% if tfuente %} {{tfuente}} {% else %} 140% {% endif %};
    font-weight: bold;
    resize: none;
    padding: 8px 8px;
    margin: 6px 0;
    box-sizing: border-box;
    width: 100%;
    height: 56pt;
    white-space: normal;
    border: thin solid;
}
div#meta
{
    font-family: "Verdana";
    font-size: {% if tfuente %} {{tfuente}} {% else %} 140% {% endif %};
    resize: none;
    padding: 8px 8px;
    margin: 6px 0;
    box-sizing: border-box;
    width: 100%;
    height: 56pt;
    white-space: normal;
    border: thin solid;
}
span.lengua
{
    font-size: 120%;
    font-weight: bold;
}
textarea.ometa
{
    font-family: "Verdana";
    resize: none;
    font-size: 120%;
    padding: 4px 4px;
    margin: 18px 0px 6px 0px;
}
.btndesplegable {
    font-family: "Verdana";
    background-color: #666666;
    color: white;
    font-size: 100%;
    padding-left: 5px;
    padding-right: 5px;
    padding-bottom: 2px;
    margin: none;
    border: none;
}

/*
.btndesplegable:hover, .btndesplegable:focus {
    background-color: #2980B9;
}
*/

.opcion {
    font-size: 100%;
    cursor: pointer;
}

.desplegable {
    position: relative;
    display: inline-block;
}

.contenido-desplegable {
    display: none;
    position: absolute;
    background-color: #f1f1f1;
    min-width: 160px;
    overflow: auto;
    padding: 4px 4px;
    box-shadow: 0px 8px 16px 8px rgba(0,0,0,0.4);
    z-index: 1;
}

/*
.contenido-desplegable a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}

.desplegable a:hover {background-color: #ddd;}
*/

.show {display: block;}

td.instruc
{
   vertical-align: top;
}
div.instruc
{
   vertical-align: top;
   line-height: 1.1;
   width: 100%;
   font-family: "Verdana";
   font-size: 100%;
   border: none;
   margin: none;
}

textarea#comment
{
   font-family: "Verdana";
   font-size: 100%;
   width: 380px;
   height: 50px;
}
/*
input.button
{
   background-color: #00a;
   color: #fff;
   font-family: "Verdana";
   font-size: 120%;
   align: center;
   width: 100%;
}
input.button:hover
{
   background-color: #00f;
}
*/
</style>

<title>Mainumby: un Ayudante para la Traducción Castellano-Guaraní</title>

</head>

<body>

<table class='left'>
<form name="Form1" method=POST>

<tr class="brown">
    <td class="title">
    <a href="base">
    <img class='banner' src="{{url_for('static',
      filename='banner_logo.png')}}" alt="" width="300px"
      height="52px" />
    </a>
    </td>

    <td class="title" style="width: 800px">
    </td>

    <td class="menu" style="width: 200px">
      <input class="menu" type="submit" value="SALIR" name="salir" onclick="return alSalir();">
    </td>

    <td class="menu" style="width: 200px">
      <button class="menu" onclick="mostrarAyuda();">AYUDA</button>
    </td>
    <input type="hidden" name="ayuda" value="">
    <input type="hidden" name="modo" value="ora">
</tr>
</form>

</table>

<!--
<h2>Instrucciones</h2>

<p id="instructions" class="instructions">
{% if sentence %}
Hac&eacute; clic sobre un segmento colorizado de la oración para ver abajo las
opciones de traducción.
{% else %}
Introducí una palabra, frase, u oración en el espacio "Castellano", o
hac&eacute; clic en "Salir" si has terminado la sesión.
{% endif %}
</p>
-->

<p id="error" class="error">
</p>

<h1>Traducción de palabras y oraciones</h1>

<table class='left'>

  <tr>
    <td style="width: 600px">
      <span class="lengua">Castellano</span>
    </td>
    <td style="width: 25px"></td>
    <td style="width: 600px">
      <span class="lengua">Guaraní</span>
  </tr>

  <tr>
    <td>
    <div id='fuente' contenteditable="true">{% if sentence %}{{sentence|safe}}{% endif %}</div>
    </td>

    <td></td>

    <td>
    <div id='meta'>
    {% if translation %}
      {% for trans in translation %}
      {{trans[2]|safe}}
      {% endfor %}
    {% endif %}
    </div>
    </td>
  </tr>

  <tr>
    <td class='instruc'>
    {% if sentence %}
    <input type="button" value="Borrar" id="button" onclick="borrar()">
    {% else %}
    <div class="instruc" id="instruc_fuente">Escribí una palabra,
    frase, u oración, y luego presioná Intro/Enter para traducirla.</div>
    {% endif %}
    </td>

    <td></td>

    <td class='instruc'>
    {% if trans1 %}
    <div class='instruc'>
    • Para segmentos marcados con "▾", pod&eacute;s seleccionar otra opción.<br />
    • Para cambiar la posición de un segmento, arrastralo sobre otro segmento.</div>
    {% endif %}
    </td>
  </tr>

  {% if trans1 %}
  <tr>
    <td></td><td></td>
    <td>
      <textarea class='ometa' id='textmeta' style='width: 600px'>{{trans1|safe}}</textarea>
    </td>
  </tr>

  <tr>
    <td></td><td></td>
    <td class='instruc'>
      <div class="instruc" id="instruc_trad">• Si no estás satisfecho
    con la traducción, pod&eacute;s editarla.<br />
	• Para copiar la traducción al portapapeles, presioná el botón.
      </div><br />
      <input type="button" value="Copiar" id="button" onclick="copiar()">
    </td>
  </tr>
  {% endif %}

</table>

<form name="Form2" method=POST action='tra'>
<input type="hidden" name="ofuente" value="">
<input type="hidden" name="borrar" value=false>
<input type="hidden" name="tfuente" value="140%">
</form>

<script>
document.getElementById("fuente").focus();

document.getElementById("fuente").addEventListener("keypress", function(event) {
   key = event.which || event.keyCode;
   longFuente();
   if (key == 13) {
       event.preventDefault();
       fuenteNuevaLinea();
   }
});

function longFuente()
{
    f = document.getElementById("fuente");
    t = f.innerHTML;
    t = t.replace(/<br>/g, "");
    l = t.length;
    if (l > 40) {
//        alert("Fuente length of " + t + ": " + l);
        f.style.fontSize = "115%";
        document.Form2.tfuente.value = "115%";
    }
}

function mostrarAyuda() {
    var helpWin = window.open("", "Mainumby: Ayuda", "titlebar=yes,scrollbars=yes,status=no,top=200,left=200,width=700,height=400");
    helpWin.document.write('<html><head>' +
'<link rel="stylesheet" type=text/css href={{url_for("static", filename="style.css")}}/>' +
"<title>Mainumby: Ayuda</title></head><body>" +
"<h4 class='help'>Ayuda para usar el traductor</h4>" +
"<p class='help'>En esta página... " +
"</p><p class='help'>" +
"etc..." +
"</p></body></html>");
    document.Form1.ayuda.value = true;
}
function alSalir()
{
    document.Form2.tfuente.value = "140%";
    document.Form1.action = "fin";
    document.Form1.target = "_self";     // Same window
    document.Form1.submit();             // Submit the page
    return true;
}
function borrar()
{
    document.Form2.borrar.value = 'true';
    document.Form2.ofuente.value = '';
    document.Form2.tfuente.value = "140%";
    document.Form2.submit();
    return true;
}
function copiar()
{
    textmeta = document.getElementById("textmeta");
    textmeta.select();
    document.execCommand("copy");
}
function mayuscula(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}
function agregarTri(string) {
    return string + " \u25BE";
}
function eliminarTri(string) {
    return string.replace(/ \u25BE/g, '');
}
function limpiarMeta(string) {
    // Remove line breaks.
    string = string.replace(/(\r\n|\n|\r)/gm, "");
    string = string.trim();
    // Convert non-breaking spaces to spaces.
    string = string.replace(/\&nbsp;/g, ' ');
    // Remove menu triangle.
    string = string.replace(/ \u25BE/g, '');
    // Remove extra spaces
    string = string.replace(/\s+/g," ");
    // Remove spaces before periods, commas, and semicolons
    string = string.replace(/ \./g, ".");
    string = string.replace(/ \,/g, ",");
    string = string.replace(/ \;/g, ";");
    string = string.replace(" ?", "?");
    {% if mayus %}
    string = mayuscula(string);
    {% endif %}
    return string;
}
function limpiarGrn(string) {
    // Clean up Guarani string, replacing characters if necessary.
    string = string.replace(/[âä]/, "ã");
    string = string.replace(/à/, "á");
    string = string.replace(/[êë]/, "ẽ");
    string = string.replace(/è/, "é");
    string = string.replace(/[îï]/, "ĩ");
    string = string.replace(/ì/, "í");
    string = string.replace(/[ôö]/, "õ");
    string = string.replace(/ò/, "ó");
    string = string.replace(/[ûü]/, "ũ");
    string = string.replace(/ù/, "ú");
    string = string.replace(/[ŷÿ]/, "ỹ");
    string = string.replace(/ỳ/, "ý");
    string = string.replace(/[’`´°‘]/, "'");
    string = string.replace(/ĝ/, "g̃");
    return string;
}
function fuente() {
    f = document.getElementById("fuente").innerHTML;
    return f;
}
function fuenteNuevaLinea() {
    f = fuente();
    // May contain <br>
    f = f.replace(/<br>/g, "");
    document.getElementById("fuente").innerHTML = f;
    document.Form2.ofuente.value = f;
    document.Form2.action = "tra";
    document.Form2.submit();
}
function borrarFuente() {
    document.getElementById("fuente").innerHTML = "";
}

function cambiarMeta(button, choiceid) {
    newitem = document.getElementById(choiceid).innerHTML;
    olditem = document.getElementById(button).innerHTML;
    // Add and remove the menu dropdown triangle.
    newitem = agregarTri(newitem);
    olditem = eliminarTri(olditem);
//    alert("Changing item for choice " + choiceid + ": old item " + olditem + " and new item " + newitem);
    document.getElementById(button).innerHTML = newitem;
    document.getElementById(choiceid).innerHTML = olditem;
    actualTra();
}

/* When the user clicks on the button, toggle between hiding and showing the dropdown content */
function desplegar(button) {
    document.getElementById(button).classList.toggle("show");
}

/* Encuentra las traducciones de segmentos actualmente seleccionadas */
function actualTra() {
    var trans = "";
    var dropdowns = document.getElementsByClassName("btndesplegable");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var dropdown = dropdowns[i];
      var trans1 = dropdown.innerHTML;
      trans = trans + " " + trans1;
    }
    trans = limpiarMeta(trans);
    document.getElementById('textmeta').value = trans;
}

/* Drag and drop translation buttons */
function allowDrop(ev) {
//    alert("Allowing drop");
    ev.preventDefault();
}

function drag(ev) {
//    ev.preventDefault();
//    alert("Dragging " + ev.target.id);
    ev.dataTransfer.effectAllowed = "move";
    ev.dataTransfer.setData("text/plain", ev.target.id);
}
function drop(ev) {
    ev.preventDefault();
    var src = document.getElementById(ev.dataTransfer.getData("text/plain"));
//    alert("Dropping " + src);
    var srcParent = src.parentNode;
    var tgt = ev.currentTarget.firstElementChild;
    ev.currentTarget.replaceChild(src, tgt);
    srcParent.appendChild(tgt);
    // Update the sentence in the ometa textbox
    actualTra();
}

// Close the dropdown if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.btndesplegable')) {
    var dropdowns = document.getElementsByClassName("contenido-desplegable");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}
</script>
</body>

</html>
